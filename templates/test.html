<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guardial | Your LLM Guard</title>
    <style>
        :root {
            /* Minimal monochrome palette */
            --bg: #000000;           /* black */
            --bg-elev: #000000;      /* deep black */
            --bg-panel: #0e1320;     /* elevated panel */
            --text: #ffffff;         /* white */
            --muted: #c9d1d9;        /* soft gray */
            --accent: #ffffff;       /* white accent */
            --accent-2: #9aa4af;     /* secondary gray */
            --gold: #d6d6d6;         /* subtle silver/metal accent */
            --border: #222a36;       /* subtle border */
            --code: #000000;         /* code dark */
            --card-bg: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
            --card-border: rgba(255,255,255,0.10);
            --shadow: 0 10px 30px rgba(230, 230, 230, 0.12);
        }
        * { box-sizing: border-box; }
        html, body {
            margin: 0; padding: 0; background: var(--bg); color: var(--text); scroll-behavior: smooth;
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            line-height: 1.6; font-size: 16px;
        }
        :focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; border-radius: 6px; }

        /* Navbar: centered, detached, rounded */
        .nav {
            position: fixed; top: 36px; left: 50%; transform: translateX(-50%); z-index: 20;
            width: clamp(320px, 90vw, 900px);
            display: flex; align-items: center; justify-content: space-between;
            padding: 22px 36px;
            background: rgba(0, 0, 0, 0.75);
            border: 1px solid var(--border);
            border-radius: 100px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            /* smoother morph when we toggle immersive/compact state */
            transition: width .85s cubic-bezier(.22,.61,.36,1), padding .65s ease, gap .65s ease, background .65s ease, transform .85s cubic-bezier(.22,.61,.36,1);
        }
        .nav-left { display: flex; align-items: center; gap: 18px; }
        .brand { display: flex; align-items: center; gap: 12px; }
    .brand img.logo { height: 36px; width: auto; display: block; filter: drop-shadow(0 2px 10px rgba(255, 255, 255, 0.25)); }
        .links a {
            position: relative;
            color: rgba(255,255,255,0.9);
            margin-left: 20px; text-decoration: none; font-weight: 600; font-size: 15px; letter-spacing: 0.2px;
            transition: color .2s ease, text-shadow .2s ease;
        }
        .links a::after{
            content: ""; position: absolute; left: 0; right: 0; bottom: -8px; height: 2px;
            background: linear-gradient(90deg, rgba(214,214,214,0.95), rgba(214,214,214,0.6));
            transform: scaleX(0); transform-origin: left; transition: transform .2s ease;
            border-radius: 2px;
        }
        .links a:hover { color: #ffffff; text-shadow: 0 0 16px rgba(255, 255, 255, 0.25); }
        .links a:hover::after { transform: scaleX(1); }

        /* Try now button */
        .btn-try {
            display: inline-flex; align-items: center; gap: 10px;
            padding: 10px 16px; margin-left: 0;
            /* Metallic finish: grain + sheen + body */
            background:
                /* subtle horizontal grain */
                repeating-linear-gradient(90deg, rgba(255,255,255,0.06) 0px, rgba(255,255,255,0.06) 1px, rgba(0,0,0,0.05) 1px, rgba(0,0,0,0.05) 2px),
                /* vertical sheen bands */
                linear-gradient(180deg, rgba(255,255,255,0.55) 0%, rgba(255,255,255,0.15) 35%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0.20) 65%, rgba(255,255,255,0.55) 100%),
                /* metal body */
                linear-gradient(135deg, #f2f2f2 0%, #d1d1d1 25%, #ededed 50%, #c6c6c6 75%, #e0e0e0 100%);
            color: #0b1520; border-radius: 999px; font-weight: 800; letter-spacing: .2px; text-decoration: none;
            border: 1px solid rgba(0,0,0,0.22);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.65), inset 0 -1px 0 rgba(0,0,0,0.25), 0 10px 24px rgba(0, 0, 0, 0.35);
            transition: transform .15s ease, filter .15s ease, box-shadow .15s ease, background .15s ease;
        }
        .btn-try:hover {
            transform: translateY(-1px);
            filter: brightness(1.01);
            box-shadow: 0 14px 30px rgba(0, 0, 0, 0.45);
            background: #000000;
            color: #ffffff; text-decoration: none;
        }
        .btn-try::after { content: none; }

        @keyframes arrow-nudge {
            0% { transform: translateX(0); }
            50% { transform: translateX(2px); }
            100% { transform: translateX(0); }
        }
        .btn-try .arrow {
            display: inline-grid; place-items: center; transition: transform .18s ease; animation: arrow-nudge 1.6s ease-in-out infinite;
            width: 22px; height: 22px; border-radius: 999px; background: #000000; color: #ffffff; font-size: 14px; line-height: 1;
        }
    .btn-try:hover .arrow { transform: translateX(4px); background: #ffffff; color: #000000; }

        /* Immersive compact nav state (activated on scroll into demo) */
        @media (min-width: 800px){
            .nav.compact { width: clamp(480px, 68vw, 860px); justify-content: center; gap: 24px; padding: 18px 28px; background: rgba(0,0,0,0.85); }
            .nav.compact .nav-left { gap: 18px; }
            .nav.compact .brand img.logo { height: 32px; filter: drop-shadow(0 1px 8px rgba(255,255,255,0.22)); transition: height .6s ease; }
            .nav.compact .links a { margin-left: 18px; }
            .nav.compact .btn-try { padding: 10px 14px; transform: scale(0.985); transition: transform .6s ease, padding .6s ease; }
        }
        @media (prefers-reduced-motion: reduce){
            .nav{ transition: none; }
            .nav.compact .brand img.logo, .nav.compact .btn-try{ transition: none; }
        }

        /* Hero with Spline */
        .hero { position: relative; height: 100vh; width: 100%; overflow: hidden; }
        .spline-container { position: absolute; inset: 0; display: flex; justify-content: center; align-items: center; }
        .spline-container iframe { width: 100%; height: 100%; transform: scale(1.2); border: 0; }
        .hero-title { position: absolute; bottom: 40px; left: 40px; font-size: 32px; font-weight: 700; text-shadow: 0 6px 24px rgba(0,0,0,0.5); }
        .hero-title strong { color: var(--accent); }

        /* Main sections */
        main { position: relative; z-index: 1; }
    .section { max-width: 1280px; margin: 0 auto; padding: 96px 24px; }
        .section { scroll-margin-top: 96px; }
    .section h2 { margin: 0 0 16px; font-size: 36px; letter-spacing: 0.2px; }
    .section p.lead { color: var(--muted); margin: 0 0 28px; font-size: 18px; }

        .panel { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 14px; padding: 20px; box-shadow: var(--shadow); }
        .row { display: grid; grid-template-columns: 1fr; gap: 16px; }
        @media (min-width: 900px) { .row.two { grid-template-columns: 1fr 1fr; } }

        /* (removed unused screenshot/window styles) */
        /* .screenshot-frame, .window-chrome, .dot, .window-title, .screenshot-body */
        .content { display: grid; gap: 20px; }
    .card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 16px; padding: 18px; }
    .input-row { display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: end; }
        .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 900px) { .result-grid { grid-template-columns: 1fr; } }

        .label-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; gap: 10px; }
        label { display: block; font-weight: 700; letter-spacing: .2px; margin-bottom: 8px; color: var(--text); font-size: 15px; }
        textarea {
            width: 100%; min-height: 160px; resize: vertical;
            background: var(--bg-elev); color: var(--text);
            border: 1px solid var(--border); border-radius: 12px; padding: 12px; font-size: 15px;
            transition: box-shadow .15s ease, border-color .15s ease;
        }
    textarea:focus { outline: none; border-color: rgba(255,255,255,0.35); box-shadow: 0 0 0 2px rgba(255,255,255,0.14); }
        .hint { color: var(--muted); font-size: 12px; margin-top: 8px; opacity: 0.9; }
        button {
            background: linear-gradient(135deg, #ffffff, #dcdcdc);
            color: #001018; font-weight: 700; border: none; border-radius: 12px; padding: 14px 22px; cursor: pointer;
            box-shadow: 0 8px 20px rgba(255, 255, 255, 0.12);
            transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
        }
        button:hover { filter: brightness(1.07); transform: translateY(-1px); box-shadow: 0 12px 28px rgba(255, 255, 255, 0.18); }
        .btn-outline { background: transparent; color: rgba(255,255,255,0.95); border: 1px solid rgba(255,255,255,0.22); box-shadow: none; padding: 14px 18px; }
        .btn-outline:hover { background: rgba(255,255,255,0.06); box-shadow: none; }

        .copy-btn {
            background: rgba(255,255,255,0.06);
            color: rgba(255,255,255,0.9);
            border: 1px solid rgba(255,255,255,0.15);
            padding: 6px 10px; border-radius: 8px; font-weight: 600; font-size: 12px; cursor: pointer;
            transition: background .15s ease, color .15s ease, border-color .15s ease, transform .15s ease;
        }
        .copy-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-1px); }

    /* New Workbench layout */
    .workbench { border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; overflow: hidden; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015)); box-shadow: 0 18px 44px rgba(0,0,0,0.4); }
    .wb-header { display: flex; align-items: center; justify-content: space-between; gap: 16px; padding: 14px 16px; background: rgba(7,12,24,0.6); border-bottom: 1px solid rgba(255,255,255,0.08); }
    .wb-title { display: flex; align-items: center; gap: 12px; font-weight: 800; letter-spacing: .2px; }
    .wb-actions { display: flex; align-items: center; gap: 10px; }
    .wb-body { padding: 16px; }
    .grid.two { display: grid; grid-template-columns: 1.1fr 1fr; gap: 16px; }
    /* Resizable split */
    .grid.two.resizable { grid-template-columns: var(--left-col, 1.1fr) 8px var(--right-col, 1fr); align-items: stretch; }
    .divider { width: 8px; border-radius: 8px; background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.08)); cursor: col-resize; transition: background .15s ease, box-shadow .15s ease; }
    .divider:hover { background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.14)); box-shadow: 0 0 0 2px rgba(255,255,255,0.05) inset; }
    @media (max-width: 1000px) { .grid.two.resizable { grid-template-columns: 1fr; } .divider { display: none; } }
    @media (max-width: 1000px) { .grid.two { grid-template-columns: 1fr; } }

    /* Ensure right (flow) panel matches left chat height and expands cleanly */
    #flowCard { display: flex; flex-direction: column; min-height: 480px; }
    #flowCard .tabbar { flex: 0 0 auto; }
    #flowCard .tab { flex: 1 1 auto; display: none; overflow: auto; }
    #flowCard .tab.active { display: flex; flex-direction: column; opacity: 1; transform: none; }
    #flowCard .pre-container { flex: 1 1 auto; max-height: none; display: flex; flex-direction: column; }
    #flowCard pre { flex: 1 1 auto; }

    /* Tabs */
    .tabbar { display: flex; gap: 8px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; padding: 6px; margin-bottom: 12px; }
    .tab-btn { background: transparent; color: rgba(255,255,255,0.85); border: none; border-radius: 8px; padding: 8px 12px; font-weight: 700; cursor: pointer; transition: background .15s ease, color .15s ease; }
    .tab-btn.active { background: rgba(255,255,255,0.12); color: #fff; }
    .tab { display: none; opacity: 0; transform: translateY(4px); transition: opacity .18s ease, transform .18s ease; }
    .tab.active { display: block; opacity: 1; transform: translateY(0); }

    /* Select (Examples) */
    .select { background: rgba(255,255,255,0.04); color: #fff; border: 1px solid rgba(255,255,255,0.16); border-radius: 10px; padding: 10px 12px; font-weight: 600; appearance: none; outline: none; }
    .select:focus { border-color: rgba(255,255,255,0.35); box-shadow: 0 0 0 2px rgba(255,255,255,0.14); }

    /* Send button loading state */
    #sendBtn { position: relative; display: inline-flex; align-items: center; gap: 10px; }
    #sendBtn .spinner { width: 14px; height: 14px; border: 2px solid rgba(255,255,255,0.35); border-top-color: #ffffff; border-radius: 50%; display: none; animation: spin 0.8s linear infinite; }
    #sendBtn.loading .spinner { display: inline-block; }
    #sendBtn.loading .btn-label { opacity: 0.7; }
    button:disabled, .btn-outline:disabled { opacity: 0.6; cursor: not-allowed; filter: none; transform: none; }
    @keyframes spin { to { transform: rotate(360deg); } }

        pre {
            background: var(--code); color: #dbeafe; border: 1px solid var(--border);
            border-radius: 12px; padding: 12px; white-space: pre-wrap; word-break: break-word; font-size: 14px; line-height: 1.5;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            max-height: 320px; overflow: auto;
        }
        /* Global wrap toggle */
        body.no-wrap pre { white-space: pre; word-break: normal; overflow: auto; }

        /* Collapsible pre containers for big content */
        .pre-container { position: relative; max-height: 280px; overflow: hidden; border-radius: 12px; }
        .pre-container.expanded { max-height: none; }
    .pre-container .fade { content: ""; position: absolute; left: 0; right: 0; bottom: 0; height: 60px; background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,0.85)); display: none; pointer-events: none; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; }
        .pre-container.collapsed .fade { display: block; }

        .toggle-btn { background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.9); border: 1px solid rgba(255,255,255,0.15); padding: 6px 10px; border-radius: 8px; font-weight: 600; font-size: 12px; cursor: pointer; transition: background .15s ease, transform .15s ease; }
        .toggle-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-1px); }

    /* Problems section (Why Armor) */
    .problem-section h2 { margin: 0 0 8px; font-size: 34px; }
    .problem-section p.sub { color: var(--muted); margin: 0 0 28px; font-size: 17px; }
    .problem-grid { display: grid; grid-template-columns: 1fr; gap: 18px; }
    @media (min-width: 900px) { .problem-grid { grid-template-columns: repeat(3, 1fr); } }
    .problem-card { position: relative; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015)); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 22px; box-shadow: 0 16px 40px rgba(0,0,0,0.35); overflow: hidden; }
    .problem-card::after { content: attr(data-idx); position: absolute; top: 16px; right: 16px; font-weight: 800; font-size: 56px; color: rgba(214,214,214,0.12); letter-spacing: 1px; }
    .p-icon { width: 56px; height: 56px; border-radius: 14px; display: grid; place-items: center; background: radial-gradient(60% 60% at 50% 30%, rgba(255,255,255,0.22), rgba(255,255,255,0.09)); border: 1px solid rgba(255,255,255,0.25); color: var(--accent); margin-bottom: 14px; box-shadow: 0 10px 30px rgba(255,255,255,0.15); }
    .problem-card h3 { margin: 0 0 8px; font-size: 20px; }
    .problem-card p { margin: 0 0 12px; color: var(--muted); }
    .p-metric { margin-top: 14px; font-weight: 800; font-size: 22px; color: var(--accent); }
    .p-metric small { display: block; font-weight: 700; font-size: 12px; color: rgba(255,255,255,0.55); letter-spacing: .3px; margin-top: 4px; text-transform: uppercase; }

        /* Features stack (card pile) */
        .features-section h2 { margin: 0 0 8px; font-size: 34px; }
        .features-section p.sub { color: var(--muted); margin: 0 0 28px; font-size: 17px; }
        .carousel { position: relative; max-width: 1100px; margin: 0 auto; }
        .stack { position: relative; display: grid; grid-auto-flow: column; grid-auto-columns: 88%; gap: 20px; overflow-x: auto; padding: 10px 8px 14px; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
        .stack::-webkit-scrollbar { height: 8px; }
        .stack::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); border-radius: 8px; }
        .stack-card {
            position: relative; top: auto;
            width: 100%; border-radius: 16px; padding: 22px; box-sizing: border-box; scroll-snap-align: center;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.95), rgba(13,20,38,0.90));
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 18px 44px rgba(0,0,0,0.40);
            transform: scale(0.95);
            transition: transform .25s ease, box-shadow .25s ease;
            overflow: hidden; isolation: isolate; z-index: 1;
        }
        .stack-card.active { transform: scale(1); box-shadow: 0 28px 64px rgba(0,0,0,0.55); z-index: 2; }
    .stack-card::after { content: attr(data-idx); position: absolute; right: 18px; top: 12px; font-weight: 800; font-size: 56px; color: rgba(214,214,214,0.12); }
        .f-head { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
    .f-icon { width: 48px; height: 48px; border-radius: 12px; display: grid; place-items: center; background: radial-gradient(60% 60% at 50% 30%, rgba(255,255,255,0.22), rgba(255,255,255,0.09)); border: 1px solid rgba(255,255,255,0.25); color: var(--accent); }
        .f-title { font-size: 20px; font-weight: 800; letter-spacing: .2px; }
        .f-body { color: var(--muted); margin: 0 0 10px; }
        .feature-list { list-style: none; padding: 0; margin: 10px 0 0; display: grid; gap: 8px; }
        .feature-list li { position: relative; padding-left: 20px; word-break: break-word; }
    .feature-list li::before { content: ""; position: absolute; left: 0; top: 8px; width: 8px; height: 8px; border-radius: 50%; background: var(--accent); box-shadow: 0 0 10px rgba(255,255,255,0.25); }

        /* Carousel nav */
        .caro-btn { position: absolute; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; border-radius: 999px; display: grid; place-items: center; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.16); color: #fff; cursor: pointer; transition: background .15s ease, transform .15s ease; }
        .caro-btn:hover { background: rgba(255,255,255,0.14); transform: translateY(-50%) scale(1.03); }
        .caro-btn:disabled { opacity: .4; cursor: not-allowed; }
        .caro-btn.prev { left: -6px; }
        .caro-btn.next { right: -6px; }

        @media (prefers-reduced-motion: reduce) {
            .stack-card { transition: none; }
        }

        /* How it works (vertical timeline) */
        .how-section h2 { margin: 0 0 8px; font-size: 34px; }
        .how-section p.sub { color: var(--muted); margin: 0 0 28px; font-size: 17px; }
        .timeline { position: relative; max-width: 1100px; margin: 0 auto; display: grid; gap: 36px; }
        /* Track */
        .timeline::before { content: ""; position: absolute; left: 88px; top: 0; bottom: 0; width: 2px; background: rgba(255,255,255,0.08); border-radius: 2px; }
        /* Progress bar that grows downward while scrolling */
    .timeline .progress { position: absolute; left: 88px; top: 0; width: 3px; height: 100%; background: linear-gradient(180deg, rgba(255,255,255,1), rgba(255,255,255,0.2)); border-radius: 3px; box-shadow: 0 0 16px rgba(255,255,255,0.25); transform-origin: top; transform: scaleY(0); }
        .step { position: relative; display: grid; grid-template-columns: 176px 1fr; align-items: start; gap: 12px; }
    .step::after { content: attr(data-idx); position: absolute; left: 0; top: 10px; font-weight: 900; font-size: 88px; color: rgba(214,214,214,0.12); pointer-events: none; transform: translateX(-20px); }
    .step .icon-badge { width: 64px; height: 64px; border-radius: 16px; display: grid; place-items: center; background: radial-gradient(60% 60% at 50% 30%, rgba(255,255,255,0.22), rgba(255,255,255,0.09)); border: 1px solid rgba(255,255,255,0.25); color: var(--accent); margin-left: 56px; box-shadow: 0 10px 30px rgba(255,255,255,0.15); }
    .step .icon-badge svg { filter: drop-shadow(0 2px 8px rgba(255,255,255,0.25)); }
        .step-card { background: linear-gradient(180deg, rgba(0, 0, 0, 0.95), rgba(13,20,38,0.90)); border: 1px solid rgba(255,255,255,0.10); border-radius: 16px; padding: 22px; box-shadow: 0 18px 44px rgba(0,0,0,0.40); position: relative; }
        .step-card h3 { margin: 0 0 8px; font-size: 22px; }
        .step-card p { margin: 0 0 12px; color: var(--muted); }
        .pill { display: inline-block; padding: 8px 12px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.06); font-weight: 700; font-size: 12px; letter-spacing: .2px; }
        @media (max-width: 900px){
            .timeline::before, .timeline .progress { left: 48px; }
            .step { grid-template-columns: 120px 1fr; }
            .step .icon-badge { margin-left: 16px; }
        }

        /* Micro hover lifts */
        .problem-card, .stack-card, .step-card, .card, .stat { transition: transform .2s ease, box-shadow .2s ease; }
        .problem-card:hover, .step-card:hover, .card:hover, .stat:hover { transform: translateY(-4px); box-shadow: 0 22px 60px rgba(0,0,0,0.5); }
        .stack-card:hover:not(.interactive) { transform: scale(0.97) translateY(-2px); }

        /* Immersive interactive spotlight + tilt */
        .interactive { position: relative; will-change: transform; transform-style: preserve-3d; }
        .interactive::before { content: ""; position: absolute; inset: -1px; border-radius: inherit; pointer-events: none; opacity: 0; transition: opacity .2s ease; mix-blend-mode: screen;
            background: radial-gradient(220px 220px at var(--mx,50%) var(--my,50%), rgba(255,255,255,0.18), rgba(255,255,255,0)); }
        .interactive:hover::before { opacity: 1; }

        /* Final CTA section */
        .cta-section { position: relative; padding: 120px 24px 140px; overflow: hidden; }
        .cta-wrap { max-width: 1100px; margin: 0 auto; text-align: center; position: relative; }
    .cta-halo { position: absolute; inset: -20% -10% auto -10%; height: 70%; pointer-events: none; background: radial-gradient(60% 60% at 50% 0%, rgba(255,255,255,0.10), rgba(255,255,255,0)); filter: blur(40px); }
        .cta-section h2 { font-size: 40px; line-height: 1.1; margin: 0 0 10px; letter-spacing: .2px; }
        .cta-section p.sub { color: var(--muted); margin: 0 auto 26px; font-size: 18px; max-width: 760px; }
        .cta-stats { display: grid; grid-template-columns: 1fr; gap: 16px; max-width: 980px; margin: 26px auto 34px; }
        @media (min-width: 860px){ .cta-stats { grid-template-columns: repeat(3, 1fr); } }
        .stat { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.10); border-radius: 16px; padding: 22px; text-align: center; box-shadow: 0 18px 44px rgba(0,0,0,0.40); }
    .stat .num { font-size: 28px; font-weight: 900; letter-spacing: .4px; margin-bottom: 6px; color: #ffffff; }
        .stat .label { color: var(--muted); font-weight: 700; font-size: 12px; letter-spacing: .3px; text-transform: uppercase; }
        .cta-actions { display: flex; align-items: center; justify-content: center; gap: 16px; margin-top: 6px; flex-wrap: wrap; }
        .cta-btn { display: inline-flex; align-items: center; gap: 12px; padding: 14px 22px; border-radius: 999px; font-weight: 800; letter-spacing: .2px; border: 1px solid rgba(0,0,0,0.22); color: #0b1520; cursor: pointer; text-decoration: none; box-shadow: inset 0 1px 0 rgba(255,255,255,0.65), inset 0 -1px 0 rgba(0,0,0,0.25), 0 10px 24px rgba(0, 0, 0, 0.35); background:
            repeating-linear-gradient(90deg, rgba(255,255,255,0.06) 0px, rgba(255,255,255,0.06) 1px, rgba(0,0,0,0.05) 1px, rgba(0,0,0,0.05) 2px),
            linear-gradient(180deg, rgba(255,255,255,0.55) 0%, rgba(255,255,255,0.15) 35%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0.20) 65%, rgba(255,255,255,0.55) 100%),
            linear-gradient(135deg, #f2f2f2 0%, #d1d1d1 25%, #ededed 50%, #c6c6c6 75%, #e0e0e0 100%);
            transition: transform .15s ease, filter .15s ease, box-shadow .15s ease, background .15s ease; }
        .cta-btn:hover { transform: translateY(-1px); filter: brightness(1.01); box-shadow: 0 14px 30px rgba(0, 0, 0, 0.45); background: #000; color: #fff; }
    .cta-btn .arrow { width: 26px; height: 26px; display: inline-grid; place-items: center; border-radius: 999px; font-size: 16px; background: #000000; color: #ffffff; transition: transform .18s ease, background .18s ease, color .18s ease; }
        .cta-btn:hover .arrow { transform: translateX(4px); background: #fff; color: #000; }
        .cta-link { color: rgba(255,255,255,0.92); text-decoration: none; font-weight: 700; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.04); }
        .cta-link:hover { background: rgba(255,255,255,0.08); }

    .status { font-weight: 700; margin-bottom: 12px; display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 999px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.18); }
    .status.success { color: #86efac; background: rgba(16, 60, 36, 0.35); border-color: rgba(34,197,94,0.35); }
    .status.blocked { color: #fca5a5; background: rgba(60, 20, 20, 0.35); border-color: rgba(239,68,68,0.35); }
    .status.warn { color: #fcd34d; background: rgba(60, 48, 16, 0.35); border-color: rgba(245,158,11,0.35); }

        .footer { text-align: center; color: var(--muted); padding: 48px 20px; border-top: 1px solid var(--border); }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="nav">
        <div class="nav-left">
            <div class="brand"><img class="logo" src="{{ url_for('static', filename='llm.png') }}" alt="LLM Logo" /></div>
            <div class="links">
                <a href="#hero" aria-label="Go home">Home</a>
                <a href="#features" aria-label="View features">Features</a>
                <a href="#how" aria-label="See how it works">How it works</a>
            </div>
        </div>
        <a class="btn-try" href="#demo" aria-label="Try Guardial now"><span>Try now</span><span class="arrow">→</span></a>
    </nav>

    <!-- Hero Spline Embed -->
    <header class="hero" id="hero">
        <div class="spline-container">
            <iframe src='https://my.spline.design/prismcoin-jW1KTaG3mdN5thoy7W6cOqfM/' frameborder='0'></iframe>
        </div>
    </header>

    <main>
        <!-- Live Demo -->
        <section class="section" id="demo">
            <h2>Guardial</h2>
            <p class="lead">Try real-time threat detection, PII redaction, and injection prevention.</p>
            <div class="workbench">
                
                <div class="wb-body">
                    <div class="grid two resizable" id="wbGrid">
                        <div class="card" style="display:flex; flex-direction:column; gap:12px; min-height:480px;">
                            <div class="label-row" style="margin-bottom:0;"><label>Chat</label>
                                <div style="display:flex; gap:8px; align-items:center;">
                                    <button class="btn-outline" onclick="resetChat()" aria-label="Reset chat">New chat</button>
                                </div>
                            </div>
                            <div id="chatMessages" class="chat-messages" role="log" aria-live="polite"></div>
                            <div class="chat-input">
                                <input id="chatInput" type="text" placeholder="Message the model…" />
                                <button id="sendBtn" onclick="sendChat()" aria-label="Send message"><span class="btn-label">Send</span><span class="spinner" aria-hidden="true"></span></button>
                            </div>
                            <div class="hint">Tip: Ctrl/Cmd + Enter to send</div>
                        </div>
                        <div class="divider" id="wbDivider" aria-label="Resize panels" title="Drag to resize"></div>
                        <div class="card" id="flowCard">
                            <div class="tabbar">
                                <button class="tab-btn active" data-tab="flow" onclick="showTab('flow', this)">Flow</button>
                                <button class="tab-btn" data-tab="json" onclick="showTab('json', this)">Raw JSON</button>
                            </div>
                            <div class="tab active" id="tab-flow">
                                <div class="label-row"><label>Backend Flow</label>
                                    <div style="display:flex; gap:8px; align-items:center;">
                                        <button class="toggle-btn" onclick="toggleWrap(this)" aria-label="Toggle wrap">Wrap</button>
                                        <button class="copy-btn" onclick="copyFrom('flowOutput', this)" aria-label="Copy Flow JSON">Copy</button>
                                    </div>
                                </div>
                                <div class="pre-container collapsed"><pre id="flowOutput"></pre><div class="fade"></div></div>
                            </div>
                            <div class="tab" id="tab-json">
                                <div class="label-row"><label>Full API Response</label><button class="copy-btn" onclick="copyFrom('jsonOutput', this)" aria-label="Copy Full API Response">Copy</button></div>
                                <div class="pre-container collapsed"><pre id="jsonOutput"></pre><div class="fade"></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section class="section how-section" id="how">
            <h2>How Guardial Works</h2>
            <p class="sub">Your journey from raw prompt to safe response in four simple steps.</p>
            <div class="timeline">
                <div class="progress" aria-hidden="true"></div>
                <div class="step" data-idx="01">
                    <div class="icon-badge" aria-hidden="true">
                        <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><path d="M4 4h16v12H5.5L4 17.5V4z" stroke="#00e7ff" stroke-width="1.8"/><path d="M8 8h8M8 11h6" stroke="#00e7ff" stroke-width="1.8" stroke-linecap="round"/></svg>
                    </div>
                    <div class="step-card">
                        <h3>Submit a Prompt</h3>
                        <p>Send your request to Guardial via the demo UI or API.</p>
                        <span class="pill">Step • Start</span>
                    </div>
                </div>

                <div class="step" data-idx="02">
                    <div class="icon-badge" aria-hidden="true">
                        <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><path d="M12 3l9 5-9 5-9-5 9-5z" stroke="#00e7ff" stroke-width="1.8"/><path d="M21 13l-9 5-9-5" stroke="#00e7ff" stroke-width="1.8"/></svg>
                    </div>
                    <div class="step-card">
                        <h3>Input Shielding</h3>
                        <p>Detect injection attempts and harmful intent; redact PII before it reaches the model.</p>
                        <span class="pill">Pre‑model</span>
                    </div>
                </div>

                <div class="step" data-idx="03">
                    <div class="icon-badge" aria-hidden="true">
                        <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><rect x="4" y="4" width="16" height="16" rx="3" stroke="#00e7ff" stroke-width="1.8"/><path d="M8 12h8" stroke="#00e7ff" stroke-width="1.8" stroke-linecap="round"/></svg>
                    </div>
                    <div class="step-card">
                        <h3>LLM Generation</h3>
                        <p>Forward the shielded prompt to the model (Gemini) for fast, high‑quality output.</p>
                        <span class="pill">Model</span>
                    </div>
                </div>

                <div class="step" data-idx="04">
                    <div class="icon-badge" aria-hidden="true">
                        <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="#00e7ff" stroke-width="1.8"/><path d="M9 12l2 2 4-4" stroke="#00e7ff" stroke-width="1.8" stroke-linecap="round"/></svg>
                    </div>
                    <div class="step-card">
                        <h3>Output Screening & Logs</h3>
                        <p>Screen responses for safety and PII; redact or block if needed and emit structured logs.</p>
                        <span class="pill">Post‑model</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Why Armor Section -->
        <section class="section problem-section" id="why">
            <h2>Why LLM Armor matters</h2>
            <p class="sub">Common failure modes in real-world LLM apps that guardrails like Prompt&nbsp;Shield help prevent.</p>
            <div class="problem-grid">
                <div class="problem-card" data-idx="01">
                    <div class="p-icon" aria-hidden="true">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M12 2l9 5v10l-9 5-9-5V7l9-5z" stroke="#00e7ff" stroke-width="1.6"/><path d="M9 12h6M9 16h6M9 8h6" stroke="#00e7ff" stroke-width="1.6" stroke-linecap="round"/></svg>
                    </div>
                    <h3>Prompt Injection & Exfiltration</h3>
                    <p>Adversaries coerce the model to reveal hidden system prompts, tool secrets, or sensitive retrievals from connected data sources.</p>
                    <div class="p-metric">High risk<small>Breakout attempts</small></div>
                </div>
                <div class="problem-card" data-idx="02">
                    <div class="p-icon" aria-hidden="true">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#00e7ff" stroke-width="1.6"/><path d="M7 9h10M7 13h6" stroke="#00e7ff" stroke-width="1.6" stroke-linecap="round"/></svg>
                    </div>
                    <h3>Sensitive Data Leakage</h3>
                    <p>PII, secrets, and regulated data can appear in prompts and responses. Apps need automatic detection and redaction before it leaves the boundary.</p>
                    <div class="p-metric">Severe<small>Data exposure</small></div>
                </div>
                <div class="problem-card" data-idx="03">
                    <div class="p-icon" aria-hidden="true">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="#00e7ff" stroke-width="1.6"/><path d="M8.5 9.5l7 7M15.5 9.5l-7 7" stroke="#00e7ff" stroke-width="1.6" stroke-linecap="round"/></svg>
                    </div>
                    <h3>Harmful or Non‑Compliant Output</h3>
                    <p>Toxic, unsafe, or policy-violating generations degrade trust and may breach compliance. Responses should be screened before delivery.</p>
                    <div class="p-metric">Frequent<small>Policy violations</small></div>
                </div>
            </div>
        </section>

        <!-- Features Stack Section -->
        <section class="section features-section" id="features">
            <h2>What Guardial shields</h2>
            <p class="sub">A quick tour of capabilities—scroll to browse the deck.</p>
            <div class="carousel" id="featureCarouselWrap">
                <button class="caro-btn prev" id="caroPrev" aria-label="Previous feature">‹</button>
                <div class="stack" id="featureCarousel">
                <article class="stack-card" data-idx="01">
                    <div class="f-head">
                        <div class="f-icon" aria-hidden="true">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h16" stroke="#00e7ff" stroke-width="1.8" stroke-linecap="round"/></svg>
                        </div>
                        <div class="f-title">Input Shielding</div>
                    </div>
                    <p class="f-body">Detect and mitigate risky prompts before they reach the model.</p>
                    <ul class="feature-list">
                        <li>Prompt injection detection and blocking</li>
                        <li>Harmful content classifier with thresholds</li>
                        <li>PII redaction via spaCy NER</li>
                    </ul>
                </article>

                <article class="stack-card" data-idx="02">
                    <div class="f-head">
                        <div class="f-icon" aria-hidden="true">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 3l9 5-9 5-9-5 9-5z" stroke="#00e7ff" stroke-width="1.8"/><path d="M21 12l-9 5-9-5" stroke="#00e7ff" stroke-width="1.8"/></svg>
                        </div>
                        <div class="f-title">Output Screening</div>
                    </div>
                    <p class="f-body">Ensure responses stay safe and compliant before users see them.</p>
                    <ul class="feature-list">
                        <li>Post-generation harmful content screen</li>
                        <li>PII redaction in responses</li>
                        <li>Block-and-log policy violations</li>
                    </ul>
                </article>

                <article class="stack-card" data-idx="03">
                    <div class="f-head">
                        <div class="f-icon" aria-hidden="true">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><rect x="4" y="4" width="16" height="16" rx="3" stroke="#00e7ff" stroke-width="1.8"/><path d="M8 9h8M8 12h6M8 15h5" stroke="#00e7ff" stroke-width="1.8" stroke-linecap="round"/></svg>
                        </div>
                        <div class="f-title">Policy & Controls</div>
                    </div>
                    <p class="f-body">Tune guardrails without redeploying code.</p>
                    <ul class="feature-list">
                        <li>JSON policy for enabling modules</li>
                        <li>Adjust thresholds and entities</li>
                        <li>Feature flags for response screening</li>
                    </ul>
                </article>

                <article class="stack-card" data-idx="04">
                    <div class="f-head">
                        <div class="f-icon" aria-hidden="true">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M4 12a8 8 0 1116 0 8 8 0 01-16 0z" stroke="#00e7ff" stroke-width="1.8"/><path d="M8 12h8" stroke="#00e7ff" stroke-width="1.8" stroke-linecap="round"/></svg>
                        </div>
                        <div class="f-title">Observability</div>
                    </div>
                    <p class="f-body">See what’s happening and why decisions were made.</p>
                    <ul class="feature-list">
                        <li>Structured JSON event logging</li>
                        <li>Policy and events API endpoints</li>
                        <li>Block/allow/redact rationales</li>
                    </ul>
                </article>

                <article class="stack-card" data-idx="05">
                    <div class="f-head">
                        <div class="f-icon" aria-hidden="true">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M8 6h8v12H8z" stroke="#00e7ff" stroke-width="1.8"/><path d="M4 10h4M16 14h4" stroke="#00e7ff" stroke-width="1.8" stroke-linecap="round"/></svg>
                        </div>
                        <div class="f-title">Pluggable Armor</div>
                    </div>
                    <p class="f-body">Optionally integrate Google Cloud Model Armor for managed screening.</p>
                    <ul class="feature-list">
                        <li>Use alongside or in place of local rules</li>
                        <li>Environment-based configuration</li>
                        <li>Minimal code changes required</li>
                    </ul>
                </article>
                </div>
                <button class="caro-btn next" id="caroNext" aria-label="Next feature">›</button>
            </div>
        </section>

        <!-- Final Call To Action -->
        <section class="cta-section" id="cta">
            <div class="cta-halo" aria-hidden="true"></div>
            <div class="cta-wrap">
                <h2>Ready to safeguard your LLM?</h2>
                <p class="sub">Ship faster with built‑in input shielding, output screening, and auditable policies — all in a minimal, ergonomic toolkit.</p>
                <div class="cta-stats" aria-hidden="true">
                    <div class="stat"><div class="num">5 Shields</div><div class="label">Injection • PII • Toxicity</div></div>
                    <div class="stat"><div class="num">JSON Policy</div><div class="label">Tune without redeploys</div></div>
                    <div class="stat"><div class="num">Logs On</div><div class="label">Decisions you can explain</div></div>
                </div>
                <div class="cta-actions">
                    <a class="cta-btn" href="#demo" aria-label="Try Guardial now"><span>Try Now</span><span class="arrow">→</span></a>
                    <a class="cta-link" href="mailto:hello@example.com" aria-label="Contact us">Contact Us</a>
                </div>
            </div>
        </section>

    </main>

    <footer class="footer">© <span id="year"></span> Guardial</footer>
    <!-- GSAP for subtle motion & scroll-driven effects -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/ScrollTrigger.min.js"></script>
    <script>
        // Footer year
        document.getElementById('year').textContent = new Date().getFullYear();

        function copyFrom(id, btn){
            try {
                const text = document.getElementById(id)?.textContent || '';
                if (!text) return;
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text);
                } else {
                    const ta = document.createElement('textarea');
                    ta.value = text; document.body.appendChild(ta); ta.select();
                    document.execCommand('copy'); document.body.removeChild(ta);
                }
                if (btn) { const orig = btn.textContent; btn.textContent = 'Copied'; setTimeout(()=>btn.textContent = orig, 900); }
            } catch(e) { console.error('Copy failed', e); }
        }

        // (removed old one-shot demo send/reset helpers)

        // Chat helpers and Ctrl+Enter to send
        document.addEventListener('DOMContentLoaded', () => {
            const ci = document.getElementById('chatInput');
            ci.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); sendChat(); }
            });

            // (examples selector removed with legacy header)

            // Default tab
            const saved = localStorage.getItem('activeTab') || 'flow';
            showTab(saved);

            // Resizer
            initResize();

            // Feature carousel activation
            initFeatureCarousel();

            // How-it-works progress (fallback if GSAP not available)
            initHowProgress();

            // GSAP animations
            initGSAPAnimations();

            // Compact nav on scroll (GSAP or IntersectionObserver fallback)
            initNavCompactScroll();

            // Immersive hovers
            initInteractiveHover();
            initMagneticButtons();
        });

        function showTab(name, btn){
            const tabs = ['flow','json'];
            tabs.forEach(t => {
                const el = document.getElementById('tab-' + t);
                if (el) el.classList.toggle('active', t === name);
            });
            localStorage.setItem('activeTab', name);
            // Toggle active class on buttons if provided
            if (btn) {
                const all = btn.parentElement.querySelectorAll('.tab-btn');
                all.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            } else {
                // ensure first tab button is active initially
                const first = document.querySelector('.tabbar .tab-btn[data-tab="' + name + '"]');
                if (first) {
                    const siblings = first.parentElement.querySelectorAll('.tab-btn');
                    siblings.forEach(b => b.classList.remove('active'));
                    first.classList.add('active');
                }
            }
        }

        function initHowProgress(){
            // If GSAP is available, ScrollTrigger will drive the progress; skip manual logic
            if (window.gsap && window.ScrollTrigger) return;
            const timeline = document.querySelector('#how .timeline');
            const bar = timeline ? timeline.querySelector('.progress') : null;
            if (!timeline || !bar) return;
            const update = () => {
                const r = timeline.getBoundingClientRect();
                const vh = window.innerHeight || document.documentElement.clientHeight;
                const total = r.height;
                // Start earlier: trigger when the top of the timeline reaches ~85% of the viewport height (near bottom)
                const trigger = vh * 0.85;
                const progressed = trigger - r.top; // becomes positive earlier
                const clamped = Math.min(total, Math.max(0, progressed));
                // Since CSS sets height:100% with scaleY, convert to ratio
                const ratio = total ? (clamped / total) : 0;
                bar.style.transform = 'scaleY(' + ratio + ')';
            };
            update();
            window.addEventListener('scroll', update, {passive:true});
            window.addEventListener('resize', update);
        }

        function initGSAPAnimations(){
            if (!(window.gsap && window.ScrollTrigger)) return;
            const gs = window.gsap; gs.registerPlugin(window.ScrollTrigger);

            // Nav subtle fade-in
            gs.from('.nav', {y: -20, opacity: 0, duration: 0.6, ease: 'power2.out'});

            // Workbench entrance
            gs.from('.workbench', {opacity: 0, y: 20, duration: 0.7, ease: 'power2.out', scrollTrigger: {trigger: '#demo', start: 'top 80%'}});
            gs.from('#demo .card', {opacity: 0, y: 18, duration: 0.5, stagger: 0.08, ease: 'power2.out', scrollTrigger: {trigger: '#demo .wb-body', start: 'top 75%'}});

            // Why section cards
            gs.from('#why .problem-card', {opacity: 0, y: 22, duration: 0.6, stagger: 0.1, ease: 'power2.out', scrollTrigger: {trigger: '#why', start: 'top 80%'}});

            // Features cards (first reveal)
            gs.from('#features .stack-card', {opacity: 0, y: 20, duration: 0.6, stagger: 0.08, ease: 'power2.out', scrollTrigger: {trigger: '#features', start: 'top 80%'}});

            // Timeline steps pop-in
            gs.from('#how .step', {opacity: 0, x: -14, duration: 0.5, stagger: 0.12, ease: 'power2.out', scrollTrigger: {trigger: '#how', start: 'top 85%'}});
            gs.from('#how .icon-badge', {scale: 0.8, opacity: 0, duration: 0.4, stagger: 0.12, ease: 'back.out(1.6)', scrollTrigger: {trigger: '#how', start: 'top 85%'}});

            // Timeline progress driven by ScrollTrigger (smooth, synced)
            const tlWrap = document.querySelector('#how .timeline');
            const bar = tlWrap ? tlWrap.querySelector('.progress') : null;
            if (tlWrap && bar){
                gs.set(bar, {transformOrigin: 'top'});
                gs.to(bar, {scaleY: 1, ease: 'none', scrollTrigger: {
                    trigger: tlWrap,
                    start: 'top 90%',
                    end: 'bottom 20%',
                    scrub: true
                }});
            }

            // CTA reveal
            gs.from('#cta .cta-wrap', {opacity: 0, y: 26, duration: 0.7, ease: 'power2.out', scrollTrigger: {trigger: '#cta', start: 'top 80%'}});
            gs.from('#cta .stat', {opacity: 0, y: 16, duration: 0.5, stagger: 0.08, ease: 'power2.out', scrollTrigger: {trigger: '#cta', start: 'top 75%'}});

            // Immersive navbar compaction when demo section scrolls into view
            window.ScrollTrigger.create({
                trigger: '#demo',
                start: 'top 80%',
                end: 'bottom top',
                toggleClass: {targets: '.nav', className: 'compact'}
            });
        }

        // Fallback if GSAP/ScrollTrigger not available
        function initNavCompactScroll(){
            if (window.gsap && window.ScrollTrigger) return; // GSAP path handles this
            const nav = document.querySelector('.nav');
            const target = document.querySelector('#demo');
            if (!nav || !target) return;
            if ('IntersectionObserver' in window){
                const obs = new IntersectionObserver((entries)=>{
                    entries.forEach(e => {
                        if (e.isIntersecting) nav.classList.add('compact');
                        else nav.classList.remove('compact');
                    });
                }, { root: null, threshold: 0.1 });
                obs.observe(target);
            } else {
                // Very simple scroll fallback
                const onScroll = () => {
                    const r = target.getBoundingClientRect();
                    const vh = window.innerHeight || document.documentElement.clientHeight;
                    const inView = r.top < vh * 0.8 && r.bottom > 0;
                    nav.classList.toggle('compact', inView);
                };
                onScroll();
                window.addEventListener('scroll', onScroll, {passive:true});
            }
        }

        function initInteractiveHover(){
            // Respect reduced motion and touch devices
            const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            const isCoarse = window.matchMedia('(pointer: coarse)').matches;
            if (prefersReduced || isCoarse) return;

            const tiltMax = 6; // degrees
            const selectors = '.problem-card, .stack-card, .step-card, #demo .card, .stat';
            const els = Array.from(document.querySelectorAll(selectors));
            els.forEach(el => {
                el.classList.add('interactive');
                let raf = null;
                const update = (e) => {
                    const r = el.getBoundingClientRect();
                    const x = (e.clientX - r.left);
                    const y = (e.clientY - r.top);
                    el.style.setProperty('--mx', x + 'px');
                    el.style.setProperty('--my', y + 'px');
                    const rx = ((y / r.height) - 0.5) * -2 * tiltMax; // invert so up moves up
                    const ry = ((x / r.width) - 0.5) * 2 * tiltMax;
                    el.style.transform = `perspective(800px) rotateX(${rx.toFixed(2)}deg) rotateY(${ry.toFixed(2)}deg) translateZ(2px)`;
                };
                const onMove = (e) => { if (raf) cancelAnimationFrame(raf); raf = requestAnimationFrame(() => update(e)); };
                const onLeave = () => { if (raf) cancelAnimationFrame(raf); el.style.transform = 'perspective(800px) translateZ(0)'; };
                el.addEventListener('mousemove', onMove);
                el.addEventListener('mouseleave', onLeave);
            });
        }

        function initMagneticButtons(){
            const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            const isCoarse = window.matchMedia('(pointer: coarse)').matches;
            if (isCoarse) return;

            const btns = document.querySelectorAll('.btn-try, .cta-btn');
            btns.forEach(btn => {
                let raf = null;
                const strength = 14; // px
                const move = (e) => {
                    const r = btn.getBoundingClientRect();
                    const x = e.clientX - (r.left + r.width/2);
                    const y = e.clientY - (r.top + r.height/2);
                    const dx = Math.max(-strength, Math.min(strength, x * 0.15));
                    const dy = Math.max(-strength, Math.min(strength, y * 0.15));
                    if (window.gsap && !prefersReduced){
                        gsap.to(btn, {x: dx, y: dy, duration: 0.25, ease: 'power2.out'});
                    } else {
                        btn.style.transform = `translate(${dx}px, ${dy}px)`;
                    }
                };
                const onMove = (e) => { if (raf) cancelAnimationFrame(raf); raf = requestAnimationFrame(() => move(e)); };
                const reset = () => {
                    if (window.gsap && !prefersReduced){ gsap.to(btn, {x: 0, y: 0, duration: 0.3, ease: 'power2.out'}); }
                    else { btn.style.transform = 'translate(0,0)'; }
                };
                btn.addEventListener('mousemove', onMove);
                btn.addEventListener('mouseleave', reset);
            });
        }

        function initFeatureCarousel(){
            const scroller = document.getElementById('featureCarousel');
            if (!scroller) return;
            const cards = Array.from(scroller.querySelectorAll('.stack-card'));
            const prevBtn = document.getElementById('caroPrev');
            const nextBtn = document.getElementById('caroNext');

            function nearestIndex(){
                const center = scroller.getBoundingClientRect().left + scroller.clientWidth/2;
                let best = 0, min = Infinity;
                cards.forEach((c,i)=>{
                    const r = c.getBoundingClientRect();
                    const cc = r.left + r.width/2;
                    const d = Math.abs(cc - center);
                    if (d < min){ min = d; best = i; }
                });
                return best;
            }
            function setActive(){
                const idx = nearestIndex();
                cards.forEach((c,i)=>c.classList.toggle('active', i===idx));
                if (prevBtn) prevBtn.disabled = idx === 0;
                if (nextBtn) nextBtn.disabled = idx === cards.length - 1;
            }
            function scrollToIndex(i){
                const clamped = Math.max(0, Math.min(cards.length-1, i));
                cards[clamped].scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'});
            }

            scroller.addEventListener('scroll', ()=>{
                // rAF to avoid excessive toggles
                if (scroller._raf) cancelAnimationFrame(scroller._raf);
                scroller._raf = requestAnimationFrame(setActive);
            });
            if (prevBtn) prevBtn.addEventListener('click', ()=> scrollToIndex(nearestIndex()-1));
            if (nextBtn) nextBtn.addEventListener('click', ()=> scrollToIndex(nearestIndex()+1));

            // initialize
            setTimeout(setActive, 0);
        }

        function setLoading(isLoading){
            const btn = document.getElementById('sendBtn');
            const ex = document.getElementById('examplesSelect');
            if (!btn) return;
            if (isLoading) {
                btn.classList.add('loading');
                btn.disabled = true;
                if (ex) ex.disabled = true;
            } else {
                btn.classList.remove('loading');
                btn.disabled = false;
                if (ex) ex.disabled = false;
            }
        }

        function toggleWrap(el){
            const wrapping = document.body.classList.toggle('no-wrap');
            el.textContent = wrapping ? 'No Wrap' : 'Wrap';
        }

        function initResize(){
            const grid = document.getElementById('wbGrid');
            const divider = document.getElementById('wbDivider');
            if (!grid || !divider) return;
            let dragging = false; let startX = 0; let startLeft = 0; let total = 0;

            const setCols = (leftPx) => {
                const rightPx = Math.max(280, total - leftPx - divider.offsetWidth);
                const leftFinal = Math.max(320, leftPx);
                const rightFinal = Math.max(320, rightPx);
                grid.style.setProperty('--left-col', leftFinal + 'px');
                grid.style.setProperty('--right-col', rightFinal + 'px');
                localStorage.setItem('wb_split', JSON.stringify({left:leftFinal, right:rightFinal}));
            };

            const onMove = (e) => {
                if (!dragging) return;
                const dx = (e.touches ? e.touches[0].clientX : e.clientX) - startX;
                setCols(startLeft + dx);
            };
            const onUp = () => { dragging = false; document.removeEventListener('mousemove', onMove); document.removeEventListener('mouseup', onUp); document.removeEventListener('touchmove', onMove); document.removeEventListener('touchend', onUp); };

            divider.addEventListener('mousedown', (e)=>{
                dragging = true; startX = e.clientX; total = grid.getBoundingClientRect().width; startLeft = parseFloat(getComputedStyle(grid).getPropertyValue('--left-col')) || (total*0.55);
                document.addEventListener('mousemove', onMove); document.addEventListener('mouseup', onUp);
            });
            divider.addEventListener('touchstart', (e)=>{
                dragging = true; startX = e.touches[0].clientX; total = grid.getBoundingClientRect().width; startLeft = parseFloat(getComputedStyle(grid).getPropertyValue('--left-col')) || (total*0.55);
                document.addEventListener('touchmove', onMove, {passive:false}); document.addEventListener('touchend', onUp);
            });

            // restore saved split
            const saved = localStorage.getItem('wb_split');
            if (saved) {
                try { const {left,right} = JSON.parse(saved); grid.style.setProperty('--left-col', left + 'px'); grid.style.setProperty('--right-col', right + 'px'); } catch {}
            }
        }

        // --- Chat UI ---
        const chat = { messages: [] };
        function addMessage(role, text){
            chat.messages.push({role, text});
            const box = document.getElementById('chatMessages');
            if (!box) return;
            const el = document.createElement('div');
            el.className = 'chat-msg ' + role;
            el.innerHTML = `<div class="bubble"><div class="content"></div></div>`;
            el.querySelector('.content').textContent = text;
            box.appendChild(el);
            box.scrollTop = box.scrollHeight;
        }
        async function sendChat(){
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;
            input.value = '';
            addMessage('user', text);
            setLoading(true);
            try{
                const res = await fetch('/shield_prompt', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({prompt: text}) });
                const data = await res.json();
                if (res.status === 403 && (data.status === 'blocked' || data.status === 'blocked_response')){
                    addMessage('assistant', `Blocked: ${data.reason}`);
                } else if (data.status === 'success'){
                    addMessage('assistant', data.llm_response || '(no response)');
                } else {
                    addMessage('assistant', data.error || 'Unknown error');
                }
                // Flow + JSON panels
                document.getElementById('flowOutput').textContent = JSON.stringify(data.trace || [], null, 2);
                document.getElementById('jsonOutput').textContent = JSON.stringify(data, null, 2);
            } catch(e){
                addMessage('assistant', 'Error: ' + e.message);
            } finally {
                setLoading(false);
            }
        }
        function resetChat(){
            chat.messages = [];
            const box = document.getElementById('chatMessages');
            if (box) box.innerHTML = '';
            document.getElementById('flowOutput').textContent = '';
            document.getElementById('jsonOutput').textContent = '';
            document.getElementById('chatInput').focus();
        }
    </script>
    <style>
        /* Chat UI styles */
        .chat-messages{ flex:1 1 auto; min-height:280px; max-height:60vh; overflow:auto; padding:12px; display:flex; flex-direction:column; gap:10px; background: rgba(255,255,255,0.02); border:1px solid var(--border); border-radius:12px; }
        .chat-input{ display:flex; gap:10px; align-items:center; }
        .chat-input input{ flex:1; background: var(--bg-elev); color: var(--text); border:1px solid var(--border); border-radius:12px; padding:12px 14px; font-size:15px; }
        .chat-msg{ display:flex; }
        .chat-msg.user{ justify-content: flex-end; }
        .chat-msg.assistant{ justify-content: flex-start; }
        .chat-msg .bubble{ max-width: 80%; padding: 12px 14px; border-radius: 14px; border:1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.06); box-shadow: var(--shadow); }
        .chat-msg.user .bubble{ background: linear-gradient(135deg, #ffffff, #dcdcdc); color:#001018; border-color: rgba(0,0,0,0.22); }
    </style>
</body>
</html>